<!DOCTYPE html>
<header></header>
<style>
    .stock_calc{
    margin: auto;
    position: relative;
    
}

.calc_container{
    
    font-family: "droid serif";
	background: black;
	border: none;
	border-radius: 4px;
	font-size: 15px;
	
	outline: 0;
	padding: 10px;
	
	box-sizing: border-box; 
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box; 
	background-color: #d5ccdc;
	color:#212427;
	-webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.03) inset;
	box-shadow: 0 1px 0 rgba(0,0,0,0.03) inset;
	margin-top: 30px;
    margin-bottom: 30px;
}
.label{
    padding: 10px 130px;
    font-family:"droid serif";
    font-size: 35px;
    font-weight: bold;
    color: #130f40;
}
.calc_label{
    font-family:'droid serif';
    font-size: 25px;
    padding: 10px 15px;
    font-weight: bold;
    color: #130f40;
}
.dropdown select{
    
    width: 75%;
    color: rgb(81, 78, 78);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 2px #53607e solid;
    border-radius: 22px;
    padding: 1em;
    cursor: pointer;
    transition: back-ground 0.3s;
}

.stock_input label{
    margin: 0px 20px;
}

* {
    -webkit-tap-highlight-color: transparent;
}

.stock_input input{
    
    color: rgb(81, 78, 78);
    border: 2px #53607e solid;
    padding: 0px 15px;
    height: 50px;
    width: 75%;
    margin: 8px 20px;
    border-radius: 22px;
    
    /* border:none;
  outline:none;
  display:inline-block;
  height:34px;
  vertical-align:middle;
  position:relative;
  bottom:14px;
  right:9px;
  border-radius:22px;
  width:220px;
  box-sizing:border-box;
  padding:0 18px; */
}
.calc_container button{
    margin: auto;
    height: 45px;
    width: 100px;
    font-size: 20px;
    color: rgba(255, 255, 255, 0.86);
    outline:rgba(44, 42, 42, 0.2);
    cursor: pointer;
    
    background: #53599f;
    border-radius: 3px;
    border: 1px solid #3c4479;
    transition: 0.5s;
}
.row{
    background: rgb(49, 46, 46);
}
.pContainer{
    background: rgb(49, 46, 46);
}
</style>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>iAverage âš¬ Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="styleNavbar.css" />
    <link rel="stylesheet" href="coinPrice.css" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <!--Script for the crypto prices-->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
</head>

<body>
    <!--navbar-->
    <nav class="navbar">
        <div>
            <a id="navLogo" href="/index.html">
                iAverage
            </a>
            <br />
            <p id="navSlogan">
                Calculating your future
            </p>
        </div>
        <ul class="navlist">
            <li class="navlistItem">
                <a href="/index.html">Home</a>
            </li>
            <li class="navlistItem">
                <a href="/account.html">My Account</a>
            </li>
            <li class="navlistItem">
                <a href="/aboutUs.html">About Us</a>
            </li>
        </ul>
    </nav>

    

    <!--Crypto Tickers-->
    <div class="pContainer">
        <div class="coinPrice">
            <div class="cLogo">
                <img src="/images/bitcoinLogo.png" />
            </div>
            <div class="coinTextDiv">
                <h1 class="coinText">
                    $<span id="bitcoin"></span>
                </h1>
                <h1 class="coinText">
                    Bitcoin
                </h1>
            </div>
        </div>

        <div class="coinPrice">
            <div class="cLogo">
                <img src="/images/ethLogo.png" />
            </div>
            <div class="coinTextDiv">
                <h1 class="coinText">
                    $<span id="ethereum"></span>
                </h1>
                <h1 class="coinText">
                    Etherium
                </h1>
            </div>
        </div>

        <div class="coinPrice">
            <div class="cLogo">
                <img src="/images/bnbLogo.png" />
            </div>
            <div class="coinTextDiv">
                <h1 class="coinText">
                    $<span id="binancecoin"></span>
                </h1>
                <h1 class="coinText">
                    BNB
                </h1>
            </div>
        </div>

        <div class="coinPrice">
            <div class="cLogo">
                <img src="/images/dogecoinLogo.png" />
            </div>
            <div class="coinTextDiv">
                <h1 class="coinText">
                    $<span id="dogecoin"></span>
                </h1>
                <h1 class="coinText">
                    Dogecoin
                </h1>
            </div>
        </div>

    </div>

   

    <div class="page_format">
        <div class="row">
            <div class="stock_calc">
                <div class="calc_container" float="left">
                    <h1 class="calc_label">Calculator</h1>
                    <form class="stock_input">
                        <div class="dropdown">
                            <select id="locality-dropdown" name="locality">
                            </select>
                        </div>
                        <label for="name">Currently Owned Shares</label>
                        <br />

                        <input type="text" id="curr_shares" name="curr_shares" required
                               minlength="4" maxlength="8" size="10">
                        <br />
                        <label for="name">Average Price of Shares</label>
                        <br />

                        <input type="text" id="avg_price" name="avg_price" required
                               minlength="4" maxlength="8" size="10">
                        <br />
                        <label for="name">New Shares Being Purchased</label>
                        <br />
                        <input type="text" id="new_shares" name="new_shares" required
                               minlength="4" maxlength="8" size="10">
                        <br />

                        <label for="name">Final Average Cost</label>
                        <br />

                        <input type="text" id="fin_avg_cost" name="fin_avg_cost" required
                               minlength="4" maxlength="8" size="10">

                    </form>
                    <br />
                    <br />
                    <button type="button" onclick="getAverage()">Calculate</button>
                </div>
            </div>

            <div class="stock_info">
                <table class="stock_table">
                    <tr>
                        <th>Stock Company: </th>
                        <th id="comp_name"></th>
                    </tr>
                    <tbody>
                        <tr>
                            <td>Symbol: </td>
                            <td id="comp_symbol"></td>
                        </tr>
                        <tr>
                            <td>Currency: </td>
                            <td id="currency"></td>
                        </tr>
                        <tr>
                            <td>Previous Close: </td>
                            <td id="prev_close"></td>
                        </tr>
                        <tr>
                            <td>Price Range: </td>
                            <td id="price_range"></td>
                        </tr>
                        <tr>
                            <td>Average Volume: </td>
                            <td id="avg_volume"></td>
                        </tr>
                        <tr>
                            <td>Exchange: </td>
                            <td id="exchange"></td>
                        </tr>
                    </tbody>
                </table>
                <a href="https://www.google.com/finance/" id="google_link">More Info</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>

        const compName = document.getElementById('comp_name');
        const compSymbol = document.getElementById('comp_symbol');
        const curr = document.getElementById('currency');
        const prevClose = document.getElementById('prev_close');
        const priceRange = document.getElementById('price_range');
        const avgVolume = document.getElementById('avg_volume');
        const exchange = document.getElementById('exchange');

        let dropdown = document.getElementById('locality-dropdown');
        dropdown.length = 0;

        let defaultOption = document.createElement('option');
        defaultOption.text = 'Choose Stock Company';

        dropdown.add(defaultOption);
        dropdown.selectedIndex = 0;

        const url = 'https://pkgstore.datahub.io/core/s-and-p-500-companies/constituents_json/data/297344d8dc0a9d86b8d107449c851cc8/constituents_json.json';
        // let priceURL = 'https://api.twelvedata.com/price?symbol=&apikey=60c2faf9f35740b7830c1fcdc3e12a8c';

        const request = new XMLHttpRequest();

        function getInfo(request) {

            request.open('GET', url, true);

            request.onload = function () {
                if (request.status === 200) {
                    const data = JSON.parse(request.responseText);
                    console.log(data);
                    let option;
                    for (let i = 0; i < data.length; i++) {
                        option = document.createElement('option');
                        option.text = data[i].Name;
                        //console.log(option.text);
                        option.value = data[i].Symbol;

                        dropdown.add(option);
                    }
                } else {
                    // Reached the server, but it returned an error
                }
            }

            request.onerror = function () {
                console.error('An error occurred fetching the JSON from ' + url);
            };

            return request.send();
        }
        function getPriceInfo(request) {

            request.open('GET', priceURL, true);

            request.onload = function () {
                if (request.status === 200) {
                    const data = JSON.parse(request.responseText);
                    console.log(data);
                    let option;
                    for (let i = 0; i < data.length; i++) {
                        option = document.createElement('option');
                        //option.text = data[i].Name;
                        //console.log(option.text);
                        option.value = data[i].price;

                        dropdown.add(option);
                    }
                } else {
                    // Reached the server, but it returned an error
                }
            }

            request.onerror = function () {
                console.error('An error occurred fetching the JSON from ' + url);
            };

            return request.send();
        }
        let quoteURL;
        let finURL;
        getInfo(request);
        function getAverage() {
            let shares = parseFloat(document.getElementById('curr_shares').value);
            let avgPrice = parseFloat(document.getElementById('avg_price').value);
            let stockComp = document.getElementById('locality-dropdown').value;
            let newShares = parseFloat(document.getElementById('new_shares').value);
            let newSharePrice;
            let priceURL = 'https://api.twelvedata.com/price?symbol=' + stockComp + '&apikey=60c2faf9f35740b7830c1fcdc3e12a8c'
            quoteURL = 'https://api.twelvedata.com/quote?symbol=' + stockComp + '&apikey=60c2faf9f35740b7830c1fcdc3e12a8c&source=docs';
            // finURL = 'https://www.google.com/finance/quote/'+stockComp+':NASDAQ?sa=X&ved=2ahUKEwiOrMXP1o_7AhXMk2oFHQXZCEAQ3ecFegQIHRAi';
            const req = new XMLHttpRequest();
            request.open('GET', priceURL, true);
            let option;
            let finAvg;
            request.onload = function () {
                if (request.status === 200) {
                    const data = JSON.parse(request.responseText);
                    console.log(data);

                    option = document.createElement('option');

                    newSharePrice = parseFloat(data.price);

                    finAvg = document.getElementById('fin_avg_cost').value = ((shares * avgPrice) + (newShares * newSharePrice)) / (shares + newShares);
                    console.log(finAvg);

                    dropdown.add(option);
                    getQuote();
                    $('#google_link').attr('href', finURL);

                } else {
                    // Reached the server, but it returned an error
                }
            }

            request.onerror = function () {
                console.error('An error occurred fetching the JSON from ' + url);
            };

            request.send();

        }
        function getQuote() {
            const req = new XMLHttpRequest();
            request.open('GET', quoteURL, true);

            request.onload = function () {
                if (request.status === 200) {
                    const data = JSON.parse(request.responseText);
                    console.log(data.exchange);
                    compName.innerHTML = data.name;
                    compSymbol.innerHTML = data.symbol;
                    curr.innerHTML = data.currency;
                    prevClose.innerHTML = data.previous_close;
                    avgVolume.innerHTML = data.average_volume;
                    priceRange.innerHTML = data.low + '-' + data.high;
                    exchange.innerHTML = data.exchange;
                    finURL = 'https://www.google.com/finance/quote/' + stockComp + ':' + exchange + '?sa=X&ved=2ahUKEwiOrMXP1o_7AhXMk2oFHQXZCEAQ3ecFegQIHRAi';



                } else {
                    // Reached the server, but it returned an error
                }
            }

            request.onerror = function () {
                console.error('An error occurred fetching the JSON from ' + url);
            };

            request.send();
        }

    </script>
    <!--Script for the crypto prices-->
    <script src="coinPrices.js"></script>
</body>
</html>